<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infusion Rate Calculator</title>
    <!-- Purpose: Import Tailwind CSS for modern, responsive styling -->
    <!-- Flow: CDN import provides all utility classes for layout and design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Purpose: Import Chart.js for interactive chart generation -->
    <!-- Flow: CDN import provides chart rendering capabilities -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Purpose: Enhanced mobile table styling */
        /* Flow: Improves touch targets and scroll behavior on mobile devices */
        @media (max-width: 768px) {
            /* Purpose: Better touch scrolling for tables */
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
            }
            
            /* Purpose: Larger touch targets on mobile */
            table td, table th {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            /* Purpose: Improved sticky positioning on iOS */
            .sticky {
                position: -webkit-sticky;
                position: sticky;
            }
        }
        
        /* Purpose: Custom scrollbar styling */
        .overflow-x-auto::-webkit-scrollbar {
            height: 6px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Purpose: Main container with centered layout and responsive design -->
    <!-- Flow: Creates a clean, professional medical calculator interface -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Infusion Rate Calculator</h1>
            <p class="text-gray-600">Calculate infusion rates based on dose, body weight, and concentration</p>
        </div>

        <!-- Input Form Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Calculation Parameters</h2>
            
            <!-- Purpose: Grid layout for input fields with responsive design -->
            <!-- Flow: Organizes inputs in a clean 2-column layout on larger screens -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Single Calculation Inputs -->
                <div class="space-y-4">
                    <h3 class="text-lg font-medium text-gray-700">Single Calculation</h3>
                    
                    <div>
                        <label for="dose" class="block text-sm font-medium text-gray-700 mb-1">Dose (mcg/kg/min)</label>
                        <input type="number" id="dose" step="0.01" min="0" value="0.05" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700 mb-1">Body Weight (kg)</label>
                        <input type="number" id="weight" step="1" min="1" value="70" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="concentration" class="block text-sm font-medium text-gray-700 mb-1">Concentration (mcg/ml)</label>
                        <input type="number" id="concentration" step="0.1" min="0.1" value="4" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <!-- Purpose: Single calculation result display -->
                    <!-- Flow: Shows immediate result for individual calculation -->
                    <div class="bg-blue-50 p-4 rounded-md">
                        <p class="text-sm text-gray-700">Infusion Rate:</p>
                        <p id="single-result" class="text-2xl font-bold text-blue-700">0.00 ml/hr</p>
                    </div>
                </div>
                <!--
                <!-- Chart Parameters -->
                <div class="space-y-4">
                    <h3 class="text-lg font-medium text-gray-700">Chart Parameters</h3>
                    
                    <div>
                        <label for="min-dose" class="block text-sm font-medium text-gray-700 mb-1">Min Dose (mcg/kg/min)</label>
                        <input type="number" id="min-dose" step="0.01" min="0" value="0.01" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="max-dose" class="block text-sm font-medium text-gray-700 mb-1">Max Dose (mcg/kg/min)</label>
                        <input type="number" id="max-dose" step="0.01" min="0" value="0.5" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="min-weight" class="block text-sm font-medium text-gray-700 mb-1">Min Weight (kg)</label>
                        <input type="number" id="min-weight" step="1" min="1" value="50" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="max-weight" class="block text-sm font-medium text-gray-700 mb-1">Max Weight (kg)</label>
                        <input type="number" id="max-weight" step="1" min="1" value="100" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Purpose: Action buttons for calculations and chart generation -->
            <!-- Flow: Provides clear call-to-action buttons with distinct styling -->
            <div class="flex flex-col sm:flex-row gap-4 mt-6">
                <button onclick="calculateSingle()" 
                        class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200 font-medium">
                    Calculate Single
                </button>
                <!--
                <button onclick="generateChart()" 
                        class="px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors duration-200 font-medium">
                    Generate Chart
                </button>
                -->
                <button onclick="generateTable()" 
                        class="px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors duration-200 font-medium">
                    Generate Table
                </button>
            </div>
        </div>

        <!-- Chart Section -->
         <!--
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Infusion Rate Chart</h2>
            <!-- Purpose: Canvas element for Chart.js rendering -->
            <!-- Flow: Provides drawing surface for interactive charts -->
     <!--
            <div class="relative h-96">
                <canvas id="infusionChart"></canvas>
            </div>
        </div>
    -->
        <!-- Table Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Infusion Rate Table</h2>
            <!-- Purpose: Container for dynamic table generation -->
            <!-- Flow: Will be populated with calculated infusion rates -->
            <div id="table-container" class="overflow-x-auto">
                <p class="text-gray-500 text-center py-8">Click "Generate Table" to display infusion rates</p>
            </div>
        </div>
    </div>

    <script>
        // Purpose: Global variables for chart management and calculations
        // Flow: Maintains chart instance and provides calculation functions
        let chartInstance = null;

        // Purpose: Calculate infusion rate using the formula: dose × weight × 60 / concentration
        // Flow: Takes dose (mcg/kg/min), weight (kg), concentration (mcg/ml) and returns ml/hr
        function calculateInfusionRate(dose, weight, concentration) {
            return (dose * weight * 60) / concentration;
        }

        // Purpose: Calculate and display single infusion rate result
        // Flow: Gets input values, calculates rate, updates display
        function calculateSingle() {
            const dose = parseFloat(document.getElementById('dose').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const concentration = parseFloat(document.getElementById('concentration').value);
            
            if (dose && weight && concentration) {
                const rate = calculateInfusionRate(dose, weight, concentration);
                document.getElementById('single-result').textContent = `${rate.toFixed(2)} ml/hr`;
            }
        }

        // Purpose: Generate interactive line chart showing infusion rates across different weights
        // Flow: Creates chart with multiple dose lines, each showing rates for weight range
        function generateChart() {
            const minDose = parseFloat(document.getElementById('min-dose').value);
            const maxDose = parseFloat(document.getElementById('max-dose').value);
            const minWeight = parseFloat(document.getElementById('min-weight').value);
            const maxWeight = parseFloat(document.getElementById('max-weight').value);
            const concentration = parseFloat(document.getElementById('concentration').value);

            // Purpose: Generate weight points for x-axis
            // Flow: Creates array of weights from min to max with 5kg intervals
            const weights = [];
            for (let w = minWeight; w <= maxWeight; w += 5 ) {
                weights.push(w);
            }

            // Purpose: Generate dose levels for different chart lines
            // Flow: Creates 5 dose levels evenly distributed between min and max
            const doses = [];
            const doseStep = (maxDose - minDose) / 9;
            for (let i = 0; i < 10; i++) {
                doses.push(minDose + (i * doseStep));
            }

            // Purpose: Create datasets for each dose level
            // Flow: Each dose becomes a line on the chart with different colors
            const datasets = doses.map((dose, index) => {
                const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6'];
                const data = weights.map(weight => 
                    calculateInfusionRate(dose, weight, concentration)
                );
                
                return {
                    label: `${dose.toFixed(3)} mcg/kg/min`,
                    data: data,
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    tension: 0.1
                };
            });

            // Purpose: Destroy existing chart to prevent overlap
            // Flow: Cleans up previous chart instance before creating new one
            if (chartInstance) {
                chartInstance.destroy();
            }

            // Purpose: Create new Chart.js line chart
            // Flow: Configures and renders interactive chart with hover effects
            const ctx = document.getElementById('infusionChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weights.map(w => `${w} kg`),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Infusion Rates by Body Weight and Dose'
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Body Weight (kg)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Infusion Rate (ml/hr)'
                            }
                        }
                    }
                }
            });
        }

        // Purpose: Generate mobile-friendly HTML table with sticky headers and first column
        // Flow: Creates table with fixed positioning for better mobile scrolling experience
        function generateTable() {
            const minDose = parseFloat(document.getElementById('min-dose').value);
            const maxDose = parseFloat(document.getElementById('max-dose').value);
            const minWeight = parseFloat(document.getElementById('min-weight').value);
            const maxWeight = parseFloat(document.getElementById('max-weight').value);
            const concentration = parseFloat(document.getElementById('concentration').value);

            // Purpose: Generate arrays for doses and weights
            // Flow: Creates systematic ranges for table rows and columns
            const doses = [];
            const doseStep = (maxDose - minDose) / 10;
            for (let i = 0; i <= 10; i++) {
                doses.push(minDose + (i * doseStep));
            }

            const weights = [];
            const weightStep = (maxWeight - minWeight) / 10;
            for (let i = 0; i <= 10; i++) {
                weights.push(minWeight + (i * weightStep));
            }

            // Purpose: Build mobile-friendly HTML table with sticky positioning
            // Flow: Creates table with fixed headers and first column for better mobile UX
            let tableHTML = `
                <div class="relative">
                    <!-- Purpose: Mobile scroll indicator -->
                    <!-- Flow: Shows users they can scroll horizontally on mobile -->
                    <div class="block sm:hidden text-center text-xs text-gray-500 mb-2 animate-pulse">
                        ← Swipe left/right to view more columns →
                    </div>
                    
                    <!-- Purpose: Scrollable table container with sticky elements -->
                    <!-- Flow: Enables horizontal scrolling while keeping headers visible -->
                    <div class="overflow-x-auto overflow-y-visible shadow-inner" style="max-height: 70vh;">
                        <table class="min-w-full bg-white border border-gray-200 relative">
                            <thead class="bg-gray-50 sticky top-0 z-20">
                                <tr>
                                    <!-- Purpose: Sticky first column header -->
                                    <!-- Flow: Remains visible during horizontal scrolling -->
                                    <th class="sticky left-0 z-30 bg-gray-50 px-2 sm:px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-r-2 border-gray-300 min-w-[120px]">
                                        Dose<br><span class="text-[10px] normal-case">(mcg/kg/min)</span>
                                    </th>
            `;

            // Purpose: Create sticky weight column headers
            // Flow: Each weight becomes a scrollable column header
            weights.forEach((weight, index) => {
                tableHTML += `
                    <th class="px-2 sm:px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider border-b min-w-[80px] ${index === 0 ? 'border-l-2 border-gray-300' : ''}">
                        ${weight.toFixed(1)}<br><span class="text-[10px] normal-case">kg</span>
                    </th>
                `;
            });

            tableHTML += `
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
            `;

            // Purpose: Create table rows with sticky first column
            // Flow: Each dose row has a fixed first column and scrollable data columns
            doses.forEach((dose, doseIndex) => {
                tableHTML += `
                    <tr class="${doseIndex % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-blue-50 transition-colors">
                        <!-- Purpose: Sticky first column showing dose values -->
                        <!-- Flow: Remains visible when scrolling horizontally -->
                        <td class="sticky left-0 z-10 px-2 sm:px-4 py-2 text-sm font-medium text-gray-900 border-r-2 border-gray-300 ${doseIndex % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-blue-50">
                            ${dose.toFixed(2)}
                        </td>
                `;

                weights.forEach((weight, weightIndex) => {
                    const rate = calculateInfusionRate(dose, weight, concentration);
                    tableHTML += `
                        <td class="px-2 sm:px-4 py-2 text-sm text-gray-700 text-center hover:bg-blue-100 transition-colors ${weightIndex === 0 ? 'border-l-2 border-gray-300' : ''}">
                            <span class="font-medium">${rate.toFixed(0)}</span>
                            <div class="text-xs text-gray-500">ml/hr</div>
                        </td>
                    `;
                });

                tableHTML += `</tr>`;
            });

            tableHTML += `
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Purpose: Mobile usage instructions -->
                    <!-- Flow: Helps users understand how to interact with the table -->
                    <div class="mt-4 text-sm text-gray-600">
                        <div class="block sm:hidden">
                            <p class="font-medium mb-1">Mobile Tips:</p>
                            <ul class="text-xs space-y-1">
                                <li>• Scroll horizontally to see all weight columns</li>
                                <li>• First column (doses) stays visible while scrolling</li>
                                <li>• Tap any cell to see the exact calculation</li>
                            </ul>
                        </div>
                        <p class="mt-2">All rates shown in ml/hr based on concentration of ${concentration} mcg/ml</p>
                    </div>
                </div>
            `;

            document.getElementById('table-container').innerHTML = tableHTML;
        }

        // Purpose: Initialize calculator with default single calculation
        // Flow: Performs initial calculation when page loads
        document.addEventListener('DOMContentLoaded', function() {
            calculateSingle();
        });

        // Purpose: Real-time calculation updates as user types
        // Flow: Recalculates single result whenever input values change
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', function() {
                if (['dose', 'weight', 'concentration'].includes(this.id)) {
                    calculateSingle();
                }
            });
        });
    </script>
</body>
</html>
